"use strict";function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.userController=void 0;var _createClass=function(){function e(e,a){for(var r=0;r<a.length;r++){var o=a[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(a,r,o){return r&&e(a.prototype,r),o&&e(a,o),a}}(),_userModel=require("user-model"),_imgUpload=require("img-upload"),_navigationHelper=require("navigation-helper"),_validator=require("validator"),_templateLoader=require("template-loader"),_dateHelper=require("date-helper"),UserController=function(){function e(){_classCallCheck(this,e),this.helpers=_imgUpload.uploadImg,this.userModel=_userModel.userModel,this.templateLoader=_templateLoader.templateLoader,this.navUser=_navigationHelper.navUser,this.validator=_validator.validator}return _createClass(e,[{key:"register",value:function(e){var a={email:e.params.email,password:e.params.password},r="";_userModel.userModel.register(a).then(function(){console.log("user created"),_navigationHelper.navUser.toggleNavigationUserElement(),_imgUpload.uploadImg.uploadToApi($("#avatar")[0].files[0]).then(function(a){r=a.data.link,_userModel.userModel.updateProfile({displayName:e.params.username,photoURL:r}).then(function(){e.redirect("#/")}).catch(function(e){console.log(e.msg)})})}).catch(function(e){console.log(e.message),$(".label.label-danger").text(e.message)})}},{key:"login",value:function(e){var a={email:e.params.email,password:e.params.password};_userModel.userModel.login(a).then(function(){_navigationHelper.navUser.toggleNavigationUserElement(),e.redirect("#/")}).catch(function(e){console.log(e.message),$(".label.label-danger").text("Invalid username or password!")})}},{key:"signOut",value:function(e){_userModel.userModel.signOut().then(function(){console.log("you are now loged off"),_navigationHelper.navUser.toggleNavigationUserElement(),e.redirect("#/")}).catch(function(e){console.log(e)})}},{key:"loadRegisterPage",value:function(e){_userModel.userModel.isUserLoggedIn().then(function(a){a?e.redirect("#/"):_templateLoader.templateLoader.loadTemplate("register","#app-container").then(function(){_validator.validator.validateRegister()})})}},{key:"loadLoginPage",value:function(e){_userModel.userModel.isUserLoggedIn().then(function(a){a?e.redirect("#/"):_templateLoader.templateLoader.loadTemplate("login","#app-container").then(function(){_validator.validator.validateLogin()})})}},{key:"createComment",value:function(e){_userModel.userModel.isUserLoggedIn().then(function(a){if(a){var r=window.location.href.split("posts/")[1].split("/")[0],o=_userModel.userModel.getCurrentUser(),t={postId:r,imageUrl:e.params.imageUrl,authorName:e.params.name,content:e.params.content,authorUid:o.uid,dateOfCreation:Date.now(),monthOfCreation:(0,_dateHelper.getMonthName)(),dayOfCreation:(0,_dateHelper.getDayOfCreation)()};console.log(t),_userModel.userModel.createUserComment(t),e.redirect("#/home")}else e.redirect("#/login");e.redirect("#/register")})}}]),e}(),userController=new UserController(_userModel.userModel,_imgUpload.uploadImg,_templateLoader.templateLoader,_navigationHelper.navUser,_validator.validator);exports.userController=userController;